
var data2010 = [{
    title: "NSW", value: 24348, all: 76198
},
{
    title: "VIC", value: 18704, all: 76198
},
{
    title: "QLD", value: 15200, all: 76198
},
{
    title: "SA", value: 6137, all: 76198
},
{
    title: "WA", value: 7600, all: 76198
},
{
    title: "TAS", value: 1778, all: 76198
},
{
    title: "NT", value: 934, all: 76198
},
{
    title: "ACT", value: 1497, all: 76198
}
];

var data2011 = [{
    title: "NSW", value: 25468, all: 78992
},
{
    title: "VIC", value: 19437, all: 78992
},
{
    title: "QLD", value: 15656, all: 78992
},
{
    title: "SA", value: 6337, all: 78992
},
{
    title: "WA", value: 7671, all: 78992
},
{
    title: "TAS", value: 1814, all: 78992
},
{
    title: "NT", value: 974, all: 78992
},
{
    title: "ACT", value: 1565, all: 78992
}
];

var data2012 = [{
    title: "NSW", value: 25566, all: 79640
},
{
    title: "VIC", value: 19621, all: 79640
},
{
    title: "QLD", value: 15897, all: 79640
},
{
    title: "SA", value: 6296, all: 79640
},
{
    title: "WA", value: 7906, all: 79640
},
{
    title: "TAS", value: 1777, all: 79640
},
{
    title: "NT", value: 1008, all: 79640
},
{
    title: "ACT", value: 1569, all: 79640
}
];

var data2013 = [{
    title: "NSW", value: 26676, all: 82408
},
{
    title: "VIC", value: 20230, all: 82408
},
{
    title: "QLD", value: 16224, all: 82408
},
{
    title: "SA", value: 6457, all: 82408
},
{
    title: "WA", value: 8232, all: 82408
},
{
    title: "TAS", value: 1845, all: 82408
},
{
    title: "NT", value: 1002, all: 82408
},
{
    title: "ACT", value: 1654, all: 82408
}
];

var data2014 = [{
    title: "NSW", value: 27374, all: 85491
},
{
    title: "VIC", value: 21186, all: 85491
},
{
    title: "QLD", value: 16950, all: 85491
},
{
    title: "SA", value: 6618, all: 85491
},
{
    title: "WA", value: 8667, all: 85491
},
{
    title: "TAS", value: 1900, all: 85491
},
{
    title: "NT", value: 1053, all: 85491
},
{
    title: "ACT", value: 1654, all: 85491
}
];

var data2015 = [{
    title: "NSW", value: 28095, all: 87999
},
{
    title: "VIC", value: 21893, all: 87999
},
{
    title: "QLD", value: 17548, all: 87999
},
{
    title: "SA", value: 6712, all: 87999
},
{
    title: "WA", value: 8937, all: 87999
},
{
    title: "TAS", value: 1902, all: 87999
},
{
    title: "NT", value: 1101, all: 87999
},
{
    title: "ACT", value: 1715, all: 87999
}
];

var data2016 = [{
    title: "NSW", value: 28995, all: 91341
},
{
    title: "VIC", value: 22712, all: 91341
},
{
    title: "QLD", value: 18563, all: 91341
},
{
    title: "SA", value: 6836, all: 91341
},
{
    title: "WA", value: 9251, all: 91341
},
{
    title: "TAS", value: 1964, all: 91341
},
{
    title: "NT", value: 1164, all: 91341
},
{
    title: "ACT", value: 1768, all: 91341
}
];

var data2017 = [{
    title: "NSW", value: 30037, all: 95194
},
{
    title: "VIC", value: 23762, all: 95194
},
{
    title: "QLD", value: 19553, all: 95194
},
{
    title: "SA", value: 7009, all: 95194
},
{
    title: "WA", value: 9631, all: 95194
},
{
    title: "TAS", value: 2059, all: 95194
},
{
    title: "NT", value: 1221, all: 95194
},
{
    title: "ACT", value: 1820, all: 95194
}
];

var data2018 = [{
    title: "NSW", value: 30809, all: 98395
},
{
    title: "VIC", value: 24641, all: 98395
},
{
    title: "QLD", value: 20334, all: 98395
},
{
    title: "SA", value: 7161, all: 98395
},
{
    title: "WA", value: 9974, all: 98395
},
{
    title: "TAS", value: 2211, all: 98395
},
{
    title: "NT", value: 1256, all: 98395
},
{
    title: "ACT", value: 1893, all: 98395
}
];

var data2019 = [{
    title: "NSW", value: 31817, all: 101841
},
{
    title: "VIC", value: 25684, all: 101841
},
{
    title: "QLD", value: 21041, all: 101841
},
{
    title: "SA", value: 7365, all: 101841
},
{
    title: "WA", value: 10276, all: 101841
},
{
    title: "TAS", value: 2259, all: 101841
},
{
    title: "NT", value: 1282, all: 101841
},
{
    title: "ACT", value: 1965, all: 101841
}
];

var data2020 = [{
    title: "NSW", value: 32681, all: 105293
},
{
    title: "VIC", value: 26822, all: 105293
},
{
    title: "QLD", value: 21785, all: 105293
},
{
    title: "SA", value: 7500, all: 105293
},
{
    title: "WA", value: 10692, all: 105293
},
{
    title: "TAS", value: 2386, all: 105293
},
{
    title: "NT", value: 1286, all: 105293
},
{
    title: "ACT", value: 2020, all: 105293
}
];

var data2021 = [{
    title: "NSW", value: 33662, all: 108501
},
{
    title: "VIC", value: 27590, all: 108501
},
{
    title: "QLD", value: 22485, all: 108501
},
{
    title: "SA", value: 7640, all: 108501
},
{
    title: "WA", value: 11119, all: 108501
},
{
    title: "TAS", value: 2483, all: 108501
},
{
    title: "NT", value: 1339, all: 108501
},
{
    title: "ACT", value: 2102, all: 108501
}
];

var allData = {
    "2010": data2010,
    "2011": data2011,
    "2012": data2012,
    "2013": data2013,
    "2014": data2014,
    "2015": data2015,
    "2016": data2016,
    "2017": data2017,
    "2018": data2018,
    "2019": data2019,
    "2020": data2020,
    "2021": data2021
};

var width = 360;
var height = 360;
var radius = Math.min(width, height) / 2;
var donutWidth = 75;
var color = d3.scaleOrdinal()
    .range(["#5A39AC", "#DD98D6", "#E7C820", "#08B2B2", "blue", "red", "orange", "black"]);

var svg = d3.select('#donut')
    .append('svg')
    .attr('width', width)
    .attr('height', height)
    .append('g')
    .attr('transform', 'translate(' + (width / 2) + ',' + (height / 2) + ')');

var arc = d3.arc()
    .innerRadius(radius - donutWidth)
    .outerRadius(radius);

var pie = d3.pie()
    .value(function (d) {
        return d.value;
    })
    .sort(null);

var legendRectSize = 13;
var legendSpacing = 7;

var donutTip = d3.select("body").append("div")
    .attr("class", "donut-tip")
    .style("opacity", 0);

var path = svg.selectAll('path')
    .data(pie(data2021))
    .enter()
    .append('path')
    .attr('d', arc)
    .attr('fill', function (d, i) {
        return color(d.data.title);
    })
    .attr('transform', 'translate(0, 0)')
    .on('mouseover', function (d, i) {
        d3.select(this).transition()
            .duration('50')
            .attr('opacity', '.85');
        donutTip.transition()
            .duration(500)
            .style("opacity", 1);
        let num = d.value + " people (" + (Math.round((d.value / d.data.all) * 100)).toString() + '%)';
        donutTip.html(num)
            .style("left", (d3.event.pageX + 10) + "px")
            .style("top", (d3.event.pageY - 15) + "px");
    })
    .on('mouseout', function (d, i) {
        d3.select(this).transition()
            .duration('50')
            .attr('opacity', '1');
        donutTip.transition()
            .duration('50')
            .style("opacity", 0);
    });

var legend = svg.selectAll('.legend')
    .data(color.domain())
    .enter()
    .append('g')
    .attr('class', 'circle-legend')
    .attr('transform', function (d, i) {
        var height = legendRectSize + legendSpacing;
        var offset = height * color.domain().length / 2;
        var horz = -2 * legendRectSize - 13;
        var vert = i * height - offset;
        return 'translate(' + horz + ',' + vert + ')';
    });

legend.append('circle')
    .style('fill', color)
    .style('stroke', color)
    .attr('cx', 0)
    .attr('cy', 0)
    .attr('r', '.5rem');

legend.append('text')
    .attr('x', legendRectSize + legendSpacing)
    .attr('y', legendRectSize - legendSpacing)
    .text(function (d) {
        return d;
    });

function change(data) {
    var pieData = pie(data);

    path = path.data(pieData);

    path.transition().duration(750).attrTween("d", function (a) {
        var i = d3.interpolate(this._current, a);
        this._current = i(0);
        return function (t) {
            return arc(i(t));
        };
    });
}

d3.select('#yearDropdown').on('change', function () {
    var selectedYear = d3.select(this).property('value');
    change(allData[selectedYear]);
});